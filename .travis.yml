# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

language: R
sudo: true
cache: packages

install:
    # Install TileDB
    - git clone https://github.com/TileDB-Inc/TileDB /tmp/TileDB
    - pushd /tmp/TileDB
    - git checkout dev
    - mkdir build
    - pushd build
    - ../bootstrap --enable-verbose --prefix=/usr/local
    - make -j 4
    - sudo make -C tiledb install
    - sudo ldconfig
    - popd
    - popd

    # Install R package deps 
    - Rscript -e 'install.packages(c("devtools", "testthat", "roxygen2"); devtools::install_deps(dependencies=T)'

script:
    # Build and Test R package
    #- R CMD INSTALL --no-multiarch --with-keep.source --configure-args='--with-tiledb=/tmp/TileDB/dist' .
    #- R -e 'library(tiledb); library(devtools); devtools::test()'
    - R CMD BUILD .
    - R CMD check --no-examples $(ls -1tr tiledb_*tar.gz | tail -1)
